# H∆∞·ªõng d·∫´n Qu·∫£n l√Ω T√†i kho·∫£n D√πng Chung

## T·ªïng quan

H·ªá th·ªëng qu·∫£n l√Ω t√†i kho·∫£n d√πng chung gi√∫p theo d√µi v√† ki·ªÉm so√°t c√°c g√≥i d·ªãch v·ª• c√≥ lo·∫°i **"TEAM D√ôNG CHUNG"** ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi nhi·ªÅu kh√°ch h√†ng. ƒêi·ªÅu n√†y kh√°c v·ªõi vi·ªác ch·ªâ d·ª±a v√†o email tr√πng nhau - ch·ªâ nh·ªØng g√≥i d·ªãch v·ª• ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·∫∑c bi·ªát cho vi·ªác chia s·∫ª m·ªõi ƒë∆∞·ª£c qu·∫£n l√Ω ·ªü ƒë√¢y.

**L∆∞u √Ω quan tr·ªçng:** Ch·ªâ nh·ªØng g√≥i d·ªãch v·ª• c√≥ `account_type = "TEAM D√ôNG CHUNG"` m·ªõi ƒë∆∞·ª£c hi·ªÉn th·ªã trong h·ªá th·ªëng n√†y, kh√¥ng ph·∫£i t·∫•t c·∫£ d·ªãch v·ª• c√≥ c√πng email ƒëƒÉng nh·∫≠p.

## C√°c t√≠nh nƒÉng ch√≠nh

### 1. Danh s√°ch t√†i kho·∫£n d√πng chung (`/admin/shared-accounts`)

**Truy c·∫≠p:** T·ª´ trang qu·∫£n l√Ω d·ªãch v·ª• kh√°ch h√†ng ‚Üí "T√†i kho·∫£n d√πng chung"

**T√≠nh nƒÉng:**

-   Hi·ªÉn th·ªã danh s√°ch email ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi nhi·ªÅu d·ªãch v·ª•
-   Th·ªëng k√™ t·ªïng quan: T·ªïng t√†i kho·∫£n, d·ªãch v·ª•, t√†i kho·∫£n c√≥ v·∫•n ƒë·ªÅ, d·ªãch v·ª• s·∫Øp h·∫øt h·∫°n
-   B·ªô l·ªçc n√¢ng cao:
    -   L·ªçc theo t√†i kho·∫£n c√≥ v·∫•n ƒë·ªÅ
    -   L·ªçc theo s·ªë l∆∞·ª£ng kh√°ch h√†ng t·ªëi thi·ªÉu
    -   S·∫Øp x·∫øp theo nhi·ªÅu ti√™u ch√≠
-   Hi·ªÉn th·ªã c·∫£nh b√°o tr·ª±c quan cho:
    -   T√†i kho·∫£n c√≥ nhi·ªÅu kh√°ch h√†ng (m√†u v√†ng)
    -   T√†i kho·∫£n c√≥ d·ªãch v·ª• h·∫øt h·∫°n (m√†u ƒë·ªè)
    -   T√†i kho·∫£n c√≥ d·ªãch v·ª• s·∫Øp h·∫øt h·∫°n (m√†u v√†ng)

**C√°ch s·ª≠ d·ª•ng:**

1. Truy c·∫≠p `/admin/shared-accounts`
2. S·ª≠ d·ª•ng b·ªô l·ªçc ƒë·ªÉ t√¨m t√†i kho·∫£n c·∫ßn quan t√¢m
3. Click "Chi ti·∫øt" ƒë·ªÉ xem th√¥ng tin chi ti·∫øt t·ª´ng t√†i kho·∫£n

### 2. Chi ti·∫øt t√†i kho·∫£n d√πng chung (`/admin/shared-accounts/{email}`)

**T√≠nh nƒÉng:**

-   Th·ªëng k√™ chi ti·∫øt cho t·ª´ng email:
    -   T·ªïng s·ªë d·ªãch v·ª•
    -   S·ªë kh√°ch h√†ng s·ª≠ d·ª•ng
    -   S·ªë d·ªãch v·ª• ƒëang ho·∫°t ƒë·ªông/h·∫øt h·∫°n/s·∫Øp h·∫øt h·∫°n
-   Danh s√°ch ƒë·∫ßy ƒë·ªß c√°c d·ªãch v·ª• s·ª≠ d·ª•ng email n√†y
-   Hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u t√†i kho·∫£n
-   C·∫£nh b√°o n·∫øu c√≥ nhi·ªÅu kh√°ch h√†ng d√πng chung
-   Th√¥ng tin li√™n h·ªá kh√°ch h√†ng
-   Thao t√°c nhanh: g·ª≠i email, ƒë√°nh d·∫•u nh·∫Øc nh·ªü

**Th√¥ng tin hi·ªÉn th·ªã:**

-   Th√¥ng tin kh√°ch h√†ng v√† g√≥i d·ªãch v·ª•
-   M·∫≠t kh·∫©u t√†i kho·∫£n (c√≥ th·ªÉ ·∫©n/hi·ªán)
-   Ng√†y k√≠ch ho·∫°t v√† h·∫øt h·∫°n
-   Tr·∫°ng th√°i d·ªãch v·ª•
-   T√¨nh tr·∫°ng nh·∫Øc nh·ªü
-   Ng∆∞·ªùi ph√¢n c√¥ng d·ªãch v·ª•

### 3. B√°o c√°o t√†i kho·∫£n d√πng chung (`/admin/shared-accounts/report`)

**T√≠nh nƒÉng:**

-   **Th·ªëng k√™ t·ªïng quan:**

    -   T·ªïng d·ªãch v·ª• c√≥ email
    -   S·ªë email duy nh·∫•t
    -   S·ªë email d√πng chung
    -   S·ªë email c√≥ nhi·ªÅu kh√°ch h√†ng

-   **Top 10 t√†i kho·∫£n d√πng chung nhi·ªÅu nh·∫•t:**

    -   X·∫øp h·∫°ng theo s·ªë l∆∞·ª£ng d·ªãch v·ª•
    -   Hi·ªÉn th·ªã s·ªë kh√°ch h√†ng kh√°c nhau
    -   S·ªë d·ªãch v·ª• ƒëang ho·∫°t ƒë·ªông/ƒë√£ h·∫øt h·∫°n

-   **T√†i kho·∫£n c√≥ v·∫•n ƒë·ªÅ:**

    -   Danh s√°ch email ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi nhi·ªÅu kh√°ch h√†ng
    -   ƒê√°nh gi√° m·ª©c ƒë·ªô r·ªßi ro
    -   T√™n c√°c kh√°ch h√†ng s·ª≠ d·ª•ng
    -   Khuy·∫øn ngh·ªã x·ª≠ l√Ω

-   **Bi·ªÉu ƒë·ªì th·ªëng k√™:**
    -   Ph√¢n b·ªë d·ªãch v·ª• theo email
    -   T·ª∑ l·ªá t√†i kho·∫£n c√≥ r·ªßi ro

## Commands h·ªó tr·ª£

### 1. T·∫°o d·ªØ li·ªáu test

```bash
php artisan test:create-shared-accounts
```

T·∫°o d·ªØ li·ªáu test v·ªõi c√°c t√†i kho·∫£n d√πng chung m·∫´u.

### 2. C√°c command hi·ªán c√≥ c√≥ th·ªÉ √°p d·ª•ng

```bash
# G·ª≠i nh·∫Øc nh·ªü cho d·ªãch v·ª• s·∫Øp h·∫øt h·∫°n (bao g·ªìm t√†i kho·∫£n d√πng chung)
php artisan reminders:send

# B√°o c√°o nh·∫Øc nh·ªü
php artisan reminders:report

# Backup d·ªØ li·ªáu
php artisan backup:customers
```

## Quy tr√¨nh x·ª≠ l√Ω t√†i kho·∫£n d√πng chung

### 1. Ph√°t hi·ªán t√†i kho·∫£n c√≥ v·∫•n ƒë·ªÅ

1. Truy c·∫≠p `/admin/shared-accounts`
2. S·ª≠ d·ª•ng filter "T√†i kho·∫£n c√≥ v·∫•n ƒë·ªÅ"
3. Ki·ªÉm tra danh s√°ch t√†i kho·∫£n c√≥ nhi·ªÅu kh√°ch h√†ng

### 2. Ph√¢n t√≠ch chi ti·∫øt

1. Click "Chi ti·∫øt" ƒë·ªÉ xem th√¥ng tin c·ª• th·ªÉ
2. Ki·ªÉm tra:
    - S·ªë kh√°ch h√†ng ƒëang s·ª≠ d·ª•ng
    - Tr·∫°ng th√°i c√°c d·ªãch v·ª•
    - Th√¥ng tin li√™n h·ªá kh√°ch h√†ng

### 3. X·ª≠ l√Ω

**T√πy ch·ªçn 1: T√°ch ri√™ng t√†i kho·∫£n**

1. Li√™n h·ªá v·ªõi kh√°ch h√†ng ƒë·ªÉ t·∫°o t√†i kho·∫£n ri√™ng
2. C·∫≠p nh·∫≠t th√¥ng tin `login_email` v√† `login_password` cho t·ª´ng d·ªãch v·ª•
3. Ki·ªÉm tra l·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≤n xung ƒë·ªôt

**T√πy ch·ªçn 2: Qu·∫£n l√Ω chung c√≥ ki·ªÉm so√°t**

1. Th√¥ng b√°o cho kh√°ch h√†ng v·ªÅ vi·ªác d√πng chung
2. Thi·∫øt l·∫≠p quy t·∫Øc s·ª≠ d·ª•ng
3. Theo d√µi th∆∞·ªùng xuy√™n

### 4. B√°o c√°o v√† theo d√µi

1. S·ª≠ d·ª•ng `/admin/shared-accounts/report` ƒë·ªÉ theo d√µi xu h∆∞·ªõng
2. B√°o c√°o ƒë·ªãnh k·ª≥ cho qu·∫£n l√Ω
3. C·∫≠p nh·∫≠t quy tr√¨nh x·ª≠ l√Ω

## M·ª©c ƒë·ªô ∆∞u ti√™n x·ª≠ l√Ω

### üî¥ ∆Øu ti√™n cao (X·ª≠ l√Ω ngay)

-   T√†i kho·∫£n c√≥ ‚â•5 kh√°ch h√†ng d√πng chung
-   T√†i kho·∫£n c√≥ d·ªãch v·ª• ƒë√£ h·∫øt h·∫°n
-   T√†i kho·∫£n c√≥ khi·∫øu n·∫°i t·ª´ kh√°ch h√†ng

### üü° ∆Øu ti√™n trung b√¨nh (X·ª≠ l√Ω trong tu·∫ßn)

-   T√†i kho·∫£n c√≥ 3-4 kh√°ch h√†ng d√πng chung
-   T√†i kho·∫£n c√≥ d·ªãch v·ª• s·∫Øp h·∫øt h·∫°n
-   T√†i kho·∫£n ch∆∞a c√≥ quy t·∫Øc s·ª≠ d·ª•ng r√µ r√†ng

### üü¢ ∆Øu ti√™n th·∫•p (Theo d√µi)

-   T√†i kho·∫£n c√≥ 2 kh√°ch h√†ng d√πng chung
-   T√†i kho·∫£n ƒëang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
-   C√≥ th·ªèa thu·∫≠n r√µ r√†ng v·ªÅ vi·ªác d√πng chung

## L∆∞u √Ω quan tr·ªçng

### B·∫£o m·∫≠t

-   Ch·ªâ hi·ªÉn th·ªã m·∫≠t kh·∫©u khi c·∫ßn thi·∫øt
-   ƒê·∫£m b·∫£o ch·ªâ admin c√≥ quy·ªÅn truy c·∫≠p th√¥ng tin n√†y
-   Log m·ªçi thao t√°c li√™n quan ƒë·∫øn t√†i kho·∫£n d√πng chung

### Ph√°p l√Ω

-   ƒê·∫£m b·∫£o vi·ªác d√πng chung tu√¢n th·ªß ƒëi·ªÅu kho·∫£n d·ªãch v·ª•
-   Th√¥ng b√°o r√µ r√†ng cho kh√°ch h√†ng v·ªÅ r·ªßi ro
-   C√≥ th·ªèa thu·∫≠n b·∫±ng vƒÉn b·∫£n khi c·∫ßn thi·∫øt

### K·ªπ thu·∫≠t

-   ƒê·ªãnh k·ª≥ ki·ªÉm tra v√† c·∫≠p nh·∫≠t m·∫≠t kh·∫©u
-   Theo d√µi s·ªë l∆∞·ª£ng ƒëƒÉng nh·∫≠p ƒë·ªìng th·ªùi
-   S·∫µn s√†ng x·ª≠ l√Ω xung ƒë·ªôt khi c√≥

## Troubleshooting

### Kh√¥ng hi·ªÉn th·ªã t√†i kho·∫£n d√πng chung

**Nguy√™n nh√¢n c√≥ th·ªÉ:**

-   Kh√¥ng c√≥ d·ªØ li·ªáu (ch∆∞a c√≥ t√†i kho·∫£n n√†o d√πng chung)
-   L·ªói query do SQL mode strict
-   L·ªói quy·ªÅn truy c·∫≠p database

**C√°ch x·ª≠ l√Ω:**

1. Ki·ªÉm tra d·ªØ li·ªáu: `SELECT login_email, COUNT(*) FROM customer_services WHERE login_email IS NOT NULL GROUP BY login_email HAVING COUNT(*) > 1`
2. Ch·∫°y test data: `php artisan test:create-shared-accounts`
3. Ki·ªÉm tra error logs

### L·ªói hi·ªÉn th·ªã chi ti·∫øt t√†i kho·∫£n

**Nguy√™n nh√¢n c√≥ th·ªÉ:**

-   Email ch·ª©a k√Ω t·ª± ƒë·∫∑c bi·ªát kh√¥ng ƒë∆∞·ª£c encode
-   Kh√¥ng t√¨m th·∫•y d·ªãch v·ª• v·ªõi email ƒë√≥

**C√°ch x·ª≠ l√Ω:**

1. Ki·ªÉm tra URL encoding
2. Ki·ªÉm tra d·ªØ li·ªáu trong database
3. S·ª≠ d·ª•ng urlencode() trong route

### L·ªói b√°o c√°o

**Nguy√™n nh√¢n c√≥ th·ªÉ:**

-   L·ªói GROUP BY v·ªõi MySQL strict mode
-   D·ªØ li·ªáu b·ªã thi·∫øu ho·∫∑c corrupt

**C√°ch x·ª≠ l√Ω:**

1. Ki·ªÉm tra MySQL configuration
2. S·ª≠ d·ª•ng raw query an to√†n
3. Ki·ªÉm tra v√† clean d·ªØ li·ªáu

---

**L∆∞u √Ω:** T√†i li·ªáu n√†y ƒë∆∞·ª£c c·∫≠p nh·∫≠t theo phi√™n b·∫£n hi·ªán t·∫°i c·ªßa h·ªá th·ªëng. Vui l√≤ng ki·ªÉm tra v√† c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n khi c√≥ thay ƒë·ªïi.
